# =====================================================================
# Everyday Shop - Unified Apache Virtual Host
# Works for both LOCAL and PRODUCTION environments
# =====================================================================

<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public

    # Server names
    ServerName ${APP_URL}
    ServerAlias www.everydayplastic.co everydayplastic.co \
                 everydaysanitary.co www.everydaysanitary.co \
                 everydayfurniture.co www.everydayfurniture.co \
                 everydayhomeappliances.co www.everydayhomeappliances.co \
                 localhost 127.0.0.1

    <Directory /var/www/html/public>
        AllowOverride All
        Options Indexes FollowSymLinks
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/everyday_shop_error.log
    CustomLog ${APACHE_LOG_DIR}/everyday_shop_access.log combined

    # Redirect HTTP to HTTPS (only if HTTPS env is active)
    RewriteEngine On
    RewriteCond %{ENV:ENABLE_HTTPS} =true
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R=301,L]
</VirtualHost>


# =====================================================================
# SSL VirtualHost (only active on VPS when ENABLE_HTTPS=true)
# =====================================================================
<If "%{ENV:ENABLE_HTTPS} == 'true'">
<VirtualHost *:443>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public
    ServerName ${APP_URL}
    ServerAlias www.everydayplastic.co everydayplastic.co \
                 everydaysanitary.co www.everydaysanitary.co \
                 everydayfurniture.co www.everydayfurniture.co \
                 everydayhomeappliances.co www.everydayhomeapp
